## 1.配置自动校验 husky+eslint+lint-staged+prettier

第一版本是最简单的方案，其他的内容 vue,react 项目都可以引入，然后测试，已经测试 vue 和 react 项目，正常。

### (1)第一步：安装基础 eslint 插件，prettier

npm i eslint prettier lint-staged eslint-plugin-prettier eslint-config-prettier

### (2)第二步：增加常用文件配置

.prettier.js

```
module.exports = {
  printWidth: 120, // 换行字符串阈值
  tabWidth: 2, // 设置工具每一个水平缩进的空格数
  useTabs: false,
  semi: false, // 句末是否加分号
  vueIndentScriptAndStyle: true,
  singleQuote: true, // 用单引号
  trailingComma: "none", // 最后一个对象元素加逗号
  bracketSpacing: true, // 对象，数组加空格
  jsxBracketSameLine: true, // jsx > 是否另起一行
  arrowParens: "always", // (x) => {} 是否要有小括号
  requirePragma: false, // 不需要写文件开头的 @prettier
  insertPragma: false, // 不需要自动在文件开头插入 @prettier
};
```

.eslintrc.js

```
module.exports = {
    env: {
        'browser': true,
        'commonjs': true,
        'es6': true
    },
    extends: 'eslint:recommended',
    globals: {
        page: true,
        REACT_APP_ENV: true
    },
    parser: '@babel/eslint-parser',
    parserOptions: {
        requireConfigFile: false, // 是否需要 babel 配置文件
        sourceType: 'module', // script 或者 module
        allowImportExportEverywhere: false, // 设置为 true，import 和 export 声明 可以出现在文件的任务位置，否则只能出现在顶部
        ecmaFeatures: {
            globalReturn: false // 设置为 true，当 sourceType 为 script 时，允许全局 return
        },
        babelOptions: {
            presets: ['@babel/preset-react']
        }
    },
    plugins: [
        'react'
    ],
    rules: {
        'for-direction': 'error', // 禁止 for 循环出现方向错误的循环，比如 for (i = 0; i < 10; i--)
        'no-await-in-loop': 'off',// 禁止将 await 写在循环里
        'no-compare-neg-zero': 'error',// 禁止与负零进行比较
        'no-empty-character-class': 'error', // 禁止在正则表达式中使用空的字符集 []
        'no-extra-parens': ['error','functions'], // 禁止函数表达式中出现多余的括号
        'no-extra-semi': 'error', // 禁止出现多余的分号
        'no-func-assign': 'error', // 禁止将一个函数声明重新赋值
        'no-inner-declarations': ['error', 'both'],// 禁止在 if 代码块内出现函数声明
        'no-regex-spaces': 'error', // 禁止在正则表达式中出现连续的空格
        'no-sparse-arrays': 'error',// 禁止在数组中出现连续的逗号
        'no-unreachable': 'error', // 禁止在 return, throw, break 或 continue 之后还有代码
        'no-template-curly-in-string': 'error',// 禁止出现难以理解的多行表达式
        'use-isnan': 'error',// 必须使用 isNaN(foo)
        // 'complexity': ['error',{'max': 20}], // 禁止函数的循环复杂度超过 20
        'dot-location': ['error','property'], // 链式调用的时候，点号必须放在第二行开头处，禁止放在第一行结尾处
        'no-empty-function': [
            'error',
            {
                'allow': [
                    'functions',
                    'arrowFunctions'
                ]
            }
        ],  // 不允许有空函数，除非是将一个空函数设置为某个项的默认值
        'no-extend-native': 'error', // 禁止修改原生对象
        'no-global-assign': 'error',// 禁止对全局变量赋值
        'key-spacing': [0, {
            'beforeColon': false,
            'afterColon': true
        }],//对象字面量中冒号的前后空格
        'max-depth': [
            'error',
            5
        ], // 代码块嵌套的深度禁止超过 5 层
        'max-params': [
            'error',
            6
        ],  // 函数的参数禁止超过 6 个
        'newline-per-chained-call': 'error',//链式调用必须换行
        'no-multiple-empty-lines': ['error',{
            'max': 3,
            'maxEOF': 1,
            'maxBOF': 1
        }],// 禁止出现超过三行的连续空行
        'no-whitespace-before-property': 'error', // 禁止属性前有空格
        'nonblock-statement-body-position': [
            'error',
            'beside',
            {
                'overrides': {
                    'while': 'below'
                }
            }
        ],// 禁止 if 后面不加大括号而写两行代码
        'object-curly-newline': [
            'error',
            {
                'multiline': true,
                'consistent': true
            }
        ],// 大括号内的首尾必须有换行
        'object-property-newline': 'error', // 对象字面量内的属性每行必须只有一个

        'no-debugger': 0, // 不禁用debugger
        'no-var': 0, // 对var警告
        'semi': 0, // 不强制使用分号
        'no-irregular-whitespace': 0, // 不规则的空白不允许
        'no-trailing-spaces': 2, // 一行结束后面有空格就发出警告
        'eol-last': 0, // 文件以单一的换行符结束
        'no-underscore-dangle': 0, // 标识符不能以_开头或结尾
        'no-lone-blocks': 0, // 禁止不必要的嵌套块
        'no-class-assign': 2, // 禁止给类赋值
        'no-cond-assign': 2, // 禁止在条件表达式中使用赋值语句
        'no-const-assign': 2, // 禁止修改const声明的变量
        'no-delete-var': 2, // 不能对var声明的变量使用delete操作符
        'no-dupe-keys': 2, // 在创建对象字面量时不允许键重复
        'no-duplicate-case': 2, // switch中的case标签不能重复
        'no-useless-catch':0,//允许try catch
        'no-dupe-args': 2, // 函数参数不能重复
        'no-empty': 2, // 块语句中的内容不能为空
        'no-invalid-this': 0, // 禁止无效的this，只能用在构造器，类，对象字面量
        'no-redeclare': 2, // 禁止重复声明变量
        'no-spaced-func': 2, // 函数调用时 函数名与()之间不能有空格
        'no-this-before-super': 0, // 在调用super()之前不能使用this或super
        'no-undef': 2, // 不能有未定义的变量
        'no-use-before-define': 2, // 未定义前不能使用
        'camelcase': 0, // 强制驼峰法命名
        'jsx-quotes': [2, 'prefer-double'], // 强制在JSX属性（jsx-quotes）中一致使用双引号
        'react/display-name': 0, // 防止在React组件定义中丢失displayName
        'react/forbid-prop-types': [2, {'forbid': ['any']}], // 禁止某些propTypes
        'react/jsx-boolean-value': 2, // 在JSX中强制布尔属性符号
        // 'react/jsx-closing-bracket-location': 1, // 在JSX中验证右括号位置
        'react/jsx-curly-spacing': [2, {
            'when': 'never',
            'children': true
        }], // 在JSX属性和表达式中加强或禁止大括号内的空格。
        'react/jsx-key': 2, // 在数组或迭代器中验证JSX具有key属性
        'react/jsx-max-props-per-line': [1, {'maximum': 3}], // 限制JSX中单行上的props的最大数量
        'react/jsx-no-bind': 0, // JSX中不允许使用箭头函数和bind
        'react/jsx-no-duplicate-props': 2, // 防止在JSX中重复的props
        'react/jsx-no-literals': 0, // 防止使用未包装的JSX字符串
        'react/jsx-no-undef': 1, // 在JSX中禁止未声明的变量
        'react/jsx-pascal-case': 0, // 为用户定义的JSX组件强制使用PascalCase
        'react/jsx-sort-props': 0, // 强化props按字母排序
        'react/jsx-uses-react': 1, // 防止反应被错误地标记为未使用
        'react/jsx-uses-vars': 2, // 防止在JSX中使用的变量被错误地标记为未使用
        'react/no-danger': 0, // 防止使用危险的JSX属性
        'react/no-did-mount-set-state': 0, // 防止在componentDidMount中使用setState
        'react/no-did-update-set-state': 1, // 防止在componentDidUpdate中使用setState
        'react/no-direct-mutation-state': 2, // 防止this.state的直接变异
        'no-unused-vars':0,//允许声明，不使用的变量
        // 'react/no-multi-comp': 2, // 防止每个文件有多个组件定义
        'react/no-set-state': 0, // 防止使用setState
        'react/no-unknown-property': "off", // 防止使用未知的DOM属性
        'react/prefer-es6-class': 0, // 为React组件强制执行ES5或ES6类
        'react/prop-types': 0, // 防止在React组件定义中丢失props验证
        'react/react-in-jsx-scope': 0, // 使用JSX时防止丢失React
        'react/self-closing-comp': 0, // 防止没有children的组件的额外结束标签
        'react/sort-comp': 2, // 强制组件方法顺序
        'no-extra-boolean-cast': 0, // 禁止不必要的bool转换
        'react/no-array-index-key': 0, // 防止在数组中遍历中使用数组key做索引
        'react/no-deprecated': 1, // 不使用弃用的方法
        'react/jsx-equals-spacing': 2, // 在JSX属性中强制或禁止等号周围的空格
        'comma-dangle': 0, // 对象字面量项尾不能有逗号
        'no-mixed-spaces-and-tabs': 0, // 禁止混用tab和空格
        'prefer-arrow-callback': 0, // 比较喜欢箭头回调
        'arrow-parens': 0, // 箭头函数用小括号括起来
        'arrow-spacing': 0, //= >的前/后括号
        'react/no-unescaped-entities': 'error' // 禁止出现 HTML 中的属性，如 class
    }
};
```

### (3)配置 husky 配置

npm i husky -D
npx husky-init install # npm

如果是 yarn 或是 pnpm
安装好 husky 后,需要配置三步骤，才能正式使用
npx husky-init # Yarn 1
yarn dlx husky-init # Yarn 2+
pnpm dlx husky-init # pnpm

第一步：根据当前的 lint-staged 内容配置
"lint": "eslint . --fix",//注意配置这里.，可以换成 src 文件夹，这样只会校验 src 文件夹内容
"lint-staged": "lint-staged --allow-empty"
package.json 的 script 脚本增加下面内容,注意 "lint-staged": "lint-staged --allow-empty",表示允许创建空的提交
"lint-staged": "lint-staged --allow-empty",
"lint-staged:js": "eslint --ext .js,.jsx,.ts,.tsx ",

第二步：package.json 下面增加配置
第一种
"lint-staged": {
"**/\*.{js,jsx,ts,tsx}": "yarn run lint-staged:js",
"**/\*.{js,jsx,tsx,ts,less,md,json}": [
"eslint --fix --color",
"prettier --write"
]
},
第二种
"lint-staged": {
"\*_/_.{js,jsx,tsx,ts}": [
"prettier --write",
"eslint --cache --fix --color",
"git add"
]
},
第三种
"lint-staged": {
"\*_/_.{js,jsx,tsx,ts}": [
"prettier --write",
"eslint --fix --color",
"git add"
]
},

这里注意：自定义配置内容

第三步：将 husky 目录下的内容进行修改
husky 目录下面默认是 npm test 修改成 npm run lint-staged

例如给一个demo版本， package.json+.husky 文件夹+eslint+prettier

```
package.json中
    script中
    "prepare": "husky install",
    "lint": "eslint . --fix",
    "lint-staged": "lint-staged --allow-empty",
    增加
  "lint-staged": {
    "**/*.{js,jsx,tsx,ts}": [
      "eslint  --fix --color",
      "git add"
    ]
  },




```

### (4)注意：

这些内容前提，配置好 eslint 和 prettier 是有必要的~

### (5)常见问题：husky 可以忽略校验一些文件吗？

通过 lint-staged 配置即可。
"ignore": ["node_modules", "dist", "package-lock.json"] }

### （6）绕过 commit 校验方法

git commit --no-verify -m "略过代码检测"
但是团队开发中，会把别人坑了。

### （7）配置新增 lint-staged 格式化代码的内容

重新格式化代码
像 Prettier、ESLint/TSLint 或 stylelint 这样的工具可以根据适当的配置重新格式化代码，
方法是运行 Prettier--write / ESLint --fix / TSLint --fix / stylelint --fix。只要没有错误,lint-staged 将自动向提交添加任何修改。

```
例如
"*.js": "prettier --write"

"lint-staged": {
    "*.{js}": [
      "eslint --cache --fix",
      "prettier --write"
    ],
    "*.css": [
      "stylelint --cache --fix",
      "prettier --write"
    ]
  }

```

### （8）husky 工具

方法 1
husky 其实就是一个为 git 客户端增加 hook 的工具。可以做一些预校验。

```
 "husky": {
    "hooks": {
      "pre-commit": "npm run lint-staged",
    }
  }

```

方案 2：推荐这种情况
这个检测工具的工作，在上面安装 husky 后，npx husky-init install 后，生成.husky 中已经包含了。
pre-commit.sh 中增加，将原来的 npm test 修改为 npm run lint-staged

### （9）有时候一个项目安装增加 husky+lint-staged 后不生效

将一个 js 文件简单做一些修改，这样可以方便校验。
有时候，有缓存的影响，导致不生效。

### （10）使用多框架框架的时候，本地化的 husky 不生效。

默认 husky 只会找根目录，不会从当前子项目中找 husky 配置内容。
这里注意一下即可。
